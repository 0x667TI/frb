<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frbagwork</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      background:#050814;
      min-height:100vh;
      overflow:hidden;
      position:relative;
    }
    nav{
      position:fixed;top:0;left:0;right:0;
      background:rgba(5,8,20,0.96);
      backdrop-filter:blur(20px);
      border-bottom:1px solid rgba(148,163,184,0.25);
      padding:20px 40px;
      z-index:1000;
      display:flex;justify-content:space-between;align-items:center;
    }
    .logo{font-size:32px;font-weight:800;letter-spacing:.5px;display:flex;align-items:center;gap:12px;}
    .logo-text{
      background:linear-gradient(90deg,#0055A4 0%,#FFFFFF 50%,#EF4135 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
      filter:drop-shadow(0 0 20px rgba(0,85,164,0.6)) drop-shadow(0 0 40px rgba(239,65,53,0.4));
    }
    .eiffel-tower{width:28px;height:48px;fill:#e5e7eb;stroke:#9ca3af;stroke-width:1.2;
      filter:drop-shadow(0 2px 4px rgba(0,0,0,0.45));}
    .right-section{display:flex;align-items:center;gap:14px;}
    .socials{display:flex;align-items:center;gap:14px;}
    .social-link{
      display:inline-flex;align-items:center;justify-content:center;
      width:36px;height:36px;border-radius:999px;
      background:rgba(15,23,42,0.8);
      border:1px solid rgba(148,163,184,0.45);
      color:#e5e7eb;
      transition:background .18s ease,transform .18s ease,border-color .18s ease;
      overflow:hidden;
    }
    .social-link:hover{
      background:rgba(30,64,175,0.9);
      border-color:rgba(191,219,254,0.9);
      transform:translateY(-1px) scale(1.03);
    }
    .social-icon{width:18px;height:18px;fill:currentColor;}
    .social-img{width:26px;height:26px;display:block;object-fit:contain;}

    .volume-control{
      display:flex;align-items:center;gap:6px;
      padding:4px 8px;border-radius:999px;
      background:rgba(15,23,42,0.85);
      border:1px solid rgba(148,163,184,0.4);
    }
    .volume-icon{width:16px;height:16px;fill:#e5e7eb;}
    .volume-slider{width:110px;cursor:pointer;}

    #canvas-container{width:100%;height:100vh;position:relative;}
    canvas{display:block;cursor:grab;}
    canvas:active{cursor:grabbing;}

    .about-overlay,
    .casino-overlay{
      position:fixed;inset:0;
      background:rgba(15,23,42,0.80);
      backdrop-filter:blur(9px);
      display:none;
      align-items:center;justify-content:center;
      z-index:1600;
    }
    .about-overlay{
      background:rgba(15,23,42,0.75);
      backdrop-filter:blur(8px);
      z-index:1500;
    }

    .about-modal,
    .casino-modal{
      background:radial-gradient(circle at top,#111827,#020617);
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.55);
      box-shadow:0 18px 45px rgba(0,0,0,0.8);
      color:#e5e7eb;
    }
    .about-modal{
      max-width:720px;max-height:70vh;
      padding:24px 26px;
      display:flex;flex-direction:column;gap:12px;
    }
    .casino-modal{
      width:min(520px,92vw);
      padding:18px 18px 20px;
      display:flex;flex-direction:column;gap:10px;
    }

    .about-header,
    .casino-header{
      display:flex;justify-content:space-between;align-items:center;gap:12px;
    }
    .about-title,
    .casino-title{
      font-size:20px;font-weight:700;
    }
    .about-close,
    .casino-close{
      border:none;background:transparent;color:#9ca3af;
      font-size:18px;cursor:pointer;padding:4px 8px;
    }

    .about-content{font-size:14px;line-height:1.5;margin-top:4px;overflow-y:auto;padding-right:6px;}
    .about-content p{margin-bottom:10px;}

    .casino-body{margin-top:4px;display:flex;flex-direction:column;gap:10px;}
    .casino-text{font-size:13px;color:#e5e7eb;}

    /* --- Slot design --- */
    .slot-shell{
      margin-top:6px;
      padding:14px 16px 18px;
      border-radius:16px;
      background:radial-gradient(circle at top,#020617,#020617 40%,#020617 100%);
      border:1px solid rgba(148,163,184,0.7);
      box-shadow:0 0 25px rgba(15,23,42,0.9) inset;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
    }
    .slot-top{
      font-size:16px;
      letter-spacing:3px;
      color:#facc15;
      text-shadow:0 0 10px rgba(250,204,21,0.7),0 0 18px rgba(250,204,21,0.4);
    }
    .slot-reels-frame{
      position:relative;
      padding:10px 14px;
      border-radius:12px;
      background:linear-gradient(145deg,#020617,#111827);
      border:2px solid rgba(148,163,184,0.8);
      box-shadow:0 0 18px rgba(15,23,42,0.9);
    }
    .slot-reels{
      display:flex;justify-content:center;gap:6px;
      padding:6px 8px;
      border-radius:10px;
      background:radial-gradient(circle at top,#0b1120,#020617 60%,#020617 100%);
    }
    .slot-reel{
      width:76px;height:96px;
      border-radius:8px;
      background:linear-gradient(180deg,#020617,#020617 40%,#020617 100%);
      border:1px solid rgba(148,163,184,0.7);
      display:flex;align-items:center;justify-content:center;
      font-size:40px;
      color:#e5e7eb;
      font-weight:700;
      overflow:hidden;
      position:relative;
    }
    .slot-symbol{
      position:absolute;
      width:100%;height:100%;
      display:flex;align-items:center;justify-content:center;
      transition:transform 0.12s linear;
    }
    .slot-symbol span{font-size:40px;}
    .slot-symbol .seven{color:#f97373;text-shadow:0 0 10px rgba(248,113,113,0.9);}
    .slot-symbol .bar{
      font-size:26px;
      padding:4px 10px;
      border-radius:6px;
      background:#111827;
      border:1px solid rgba(148,163,184,0.9);
    }
    .slot-symbol .bell{
      color:#facc15;
      text-shadow:0 0 10px rgba(250,204,21,0.9);
    }
    .slot-bottom-label{
      margin-top:4px;
      font-size:11px;
      color:#9ca3af;
      text-align:center;
    }

    .slot-btn{
      margin-top:4px;
      padding:8px 26px;
      border-radius:999px;
      border:1px solid rgba(248,250,252,0.9);
      background:radial-gradient(circle at top,#f97316,#b91c1c);
      color:#f9fafb;
      font-size:13px;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:2px;
      box-shadow:0 4px 14px rgba(0,0,0,0.7);
      transition:transform .12s ease,box-shadow .12s ease,filter .12s ease;
    }
    .slot-btn:hover:not([disabled]){
      transform:translateY(-1px);
      box-shadow:0 6px 18px rgba(0,0,0,0.8);
      filter:brightness(1.05);
    }
    .slot-btn:active:not([disabled]){
      transform:translateY(1px);
      box-shadow:0 3px 10px rgba(0,0,0,0.7);
    }
    .slot-btn[disabled]{
      opacity:0.5;
      cursor:not-allowed;
      box-shadow:none;
      background:radial-gradient(circle at top,#4b5563,#111827);
      border-color:rgba(156,163,175,0.8);
    }
    .slot-status{
      margin-top:4px;
      font-size:13px;
      text-align:center;
      min-height:18px;
    }
    .slot-status.win{color:#4ade80;}
    .slot-status.lose{color:#9ca3af;}
    .slot-status.cooldown{color:#fbbf24;}
    .slot-attempts{
      font-size:12px;
      color:#9ca3af;
      text-align:center;
    }

    @media(max-width:768px){
      nav{padding:15px 20px;}
      .logo{font-size:24px;}
      .eiffel-tower{width:22px;height:38px;}
      .social-link{width:32px;height:32px;}
      .social-icon,.social-img{width:22px;height:22px;}
      .about-modal{max-width:90vw;max-height:75vh;padding:18px 18px;}
      .volume-slider{width:80px;}
      .slot-reel{width:64px;height:88px;}
      .slot-symbol span{font-size:34px;}
    }
  </style>
</head>
<body>
  <nav>
    <div class="logo">
      <span class="logo-text">Frbagwork</span>
      <svg class="eiffel-tower" viewBox="0 0 200 400" xmlns="http://www.w3.org/2000/svg">
        <g>
          <path d="M30 350 Q100 260 170 350 L150 350 Q100 290 50 350 Z" />
          <rect x="55" y="260" width="90" height="12" rx="2" />
          <rect x="70" y="185" width="60" height="10" rx="2" />
          <rect x="85" y="120" width="30" height="8" rx="2" />
          <path d="M95 120 L70 260 L60 260 L90 110 Z" />
          <path d="M105 120 L130 260 L140 260 L110 110 Z" />
          <line x1="80" y1="260" x2="120" y2="185" />
          <line x1="120" y1="260" x2="80" y2="185" />
          <line x1="90" y1="185" x2="110" y2="120" />
          <line x1="110" y1="185" x2="90" y2="120" />
          <rect x="94" y="90" width="12" height="30" rx="3" />
          <line x1="100" y1="60" x2="100" y2="90" />
          <circle cx="100" cy="58" r="3" />
        </g>
      </svg>
    </div>

    <div class="right-section">
      <div class="volume-control">
        <svg class="volume-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 9v6h4l5 4V5L9 9H5z" />
        </svg>
        <input id="bgVolume" class="volume-slider" type="range" min="0" max="1" step="0.01" value="0.6" />
      </div>
      <div class="socials">
        <a class="social-link" href="https://x.com/i/communities/1970108948532318479" target="_blank" rel="noopener noreferrer">
          <svg class="social-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 3h4.2l4.1 6.3L15.8 3H21l-7 8.4L21 21h-4.2l-4.3-6.6L8.2 21H3l7-8.6L3 3z" />
          </svg>
        </a>
        <a class="social-link" href="https://www.tiktok.com/@japansab" target="_blank" rel="noopener noreferrer">
          <svg class="social-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M16.5 5.1c.6.8 1.4 1.4 2.3 1.9.5.2 1 .4 1.5.4V11c-1.2 0-2.3-.3-3.4-.9-.5-.3-1-.6-1.4-1v6.2c0 3-2.4 5.5-5.5 5.5S4.5 18.3 4.5 15.2 6.9 9.7 10 9.7c.4 0 .8 0 1.2.1v3.1c-.4-.2-.8-.3-1.2-.3-1.2 0-2.3 1-2.3 2.5 0 1.4 1.1 2.5 2.4 2.5 1.3 0 2.4-1.1 2.4-2.5V3h3c.1.8.4 1.5.8 2.1z" />
          </svg>
        </a>
        <a class="social-link" href="https://pump.fun/" target="_blank" rel="noopener noreferrer">
          <img src="pump-logo.png" alt="pump.fun" class="social-img">
        </a>
      </div>
    </div>
  </nav>

  <!-- ABOUT -->
  <div class="about-overlay" id="aboutOverlay">
    <div class="about-modal">
      <div class="about-header">
        <div class="about-title">About</div>
        <button class="about-close" id="aboutCloseBtn">âœ•</button>
      </div>
      <div class="about-content">
        <p>This token is not just a crypto project â€” itâ€™s a 24/7 live experience.</p>
        <p>Every new market cap milestone unlocks new challenges, giveaways and live content.</p>
      </div>
    </div>
  </div>

  <!-- MINI CASINO -->
  <div class="casino-overlay" id="casinoOverlay">
    <div class="casino-modal">
      <div class="casino-header">
        <div class="casino-title">Mini Casino</div>
        <button class="casino-close" id="casinoCloseBtn">âœ•</button>
      </div>
      <div class="casino-body">
        <div class="casino-text">
          Play to get rewarded only if you are holders (proof needed to get rewarded).
        </div>
        <div class="slot-shell">
          <div class="slot-top">CASINO</div>
          <div class="slot-reels-frame">
            <div class="slot-reels">
              <div class="slot-reel">
                <div class="slot-symbol" id="reel1"><span class="bell">ðŸ””</span></div>
              </div>
              <div class="slot-reel">
                <div class="slot-symbol" id="reel2"><span class="seven">7</span></div>
              </div>
              <div class="slot-reel">
                <div class="slot-symbol" id="reel3"><span class="bell">ðŸ””</span></div>
              </div>
            </div>
          </div>
          <div class="slot-bottom-label">
  3x 7 = 1 SOL (screen & send in community)<br>
  3x BAR = 0.3 SOL (screen & send in community)<br>
  3x ðŸ”” = 0.1 SOL (screen & send in community)
</div>

          <button class="slot-btn" id="slotSpinBtn">Spin</button>
          <div class="slot-status" id="slotStatus"></div>
          <div class="slot-attempts" id="slotAttempts"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SONS -->
  <audio id="bgMusic" src="background.mp3" loop preload="auto"></audio>
  <audio id="casinoSound" src="casino.mp3" loop preload="auto"></audio>

  <div id="canvas-container"></div>

  <script>
    const canvas=document.createElement('canvas');
    const ctx=canvas.getContext('2d');
    document.getElementById('canvas-container').appendChild(canvas);
    let width=canvas.width=window.innerWidth;
    let height=canvas.height=window.innerHeight;
    const navHeight=80;

    const bgMusic=document.getElementById('bgMusic');
    const casinoSound=document.getElementById('casinoSound');

    function pauseAllSpecialSounds(){
      if(casinoSound) casinoSound.pause();
    }
    function openOverlayWithSound(overlay,sound){
      overlay.style.display='flex';
      if(bgMusic && !bgMusic.paused) bgMusic.pause();
      pauseAllSpecialSounds();
      if(sound){sound.currentTime=0;sound.play().catch(()=>{});}
    }
    function closeOverlayWithSound(overlay,sound){
      overlay.style.display='none';
      if(sound) sound.pause();
      if(bgMusic) bgMusic.play().catch(()=>{});
    }

    const aboutOverlay=document.getElementById('aboutOverlay');
    const aboutCloseBtn=document.getElementById('aboutCloseBtn');
    function showAboutModal(){aboutOverlay.style.display='flex';}
    function hideAboutModal(){aboutOverlay.style.display='none';}
    aboutCloseBtn.addEventListener('click',hideAboutModal);
    aboutOverlay.addEventListener('click',e=>{if(e.target===aboutOverlay)hideAboutModal();});

    const casinoOverlay=document.getElementById('casinoOverlay');
    const casinoCloseBtn=document.getElementById('casinoCloseBtn');
    function openCasino(){openOverlayWithSound(casinoOverlay,casinoSound);}
    function closeCasino(){closeOverlayWithSound(casinoOverlay,casinoSound);}
    casinoCloseBtn.addEventListener('click',closeCasino);
    casinoOverlay.addEventListener('click',e=>{if(e.target===casinoOverlay)closeCasino();});

    const palette={
      purple:['#C084FC','#A855F7','#581C87'],
      pink:['#FB37A3','#EC4899','#831843'],
      green:['#4ADE80','#22C55E','#14532D'],
      cyan:['#22D3EE','#06B6D4','#0E7490'],
      blue:['#60A5FA','#3B82F6','#1E3A8A'],
      teal:['#2DD4BF','#14B8A6','#115E59']
    };

    const bubbleData=[
      { label:'$50K',  radius:24, x:180,  y:250, color:palette.purple, cluster:'pair1'},
      { label:'$100K', radius:29, x:280,  y:280, color:palette.purple, cluster:'pair1'},
      { label:'$500K', radius:32, x:450,  y:200, color:palette.pink,   cluster:'pair2'},
      { label:'$1M',   radius:36, x:580,  y:240, color:palette.pink,   cluster:'pair2'},
      { label:'$3M',   radius:40, x:500,  y:400, color:palette.green,  cluster:'pair3'},
      { label:'$5M',   radius:44, x:650,  y:420, color:palette.green,  cluster:'pair3'},
      { label:'$7M',   radius:48, x:580,  y:540, color:palette.green,  cluster:'pair3'},
      { label:'$10M',  radius:52, x:850,  y:350, color:palette.cyan,   cluster:'pair4'},
      { label:'$15M',  radius:56, x:1000, y:400, color:palette.cyan,   cluster:'pair4'},
      { label:'$20M',  radius:60, x:280,  y:550, color:palette.blue,   cluster:'pair5'},
      { label:'$40M',  radius:64, x:450,  y:630, color:palette.blue,   cluster:'pair5'},
      { label:'$60M',  radius:68, x:900,  y:600, color:palette.teal,   cluster:'pair6'},
      { label:'$100M', radius:72, x:1100,y:650, color:palette.teal,   cluster:'pair6'},
      { label:'', radius:55, x:650, y:230, color:['#e5f2ff','#93c5fd','#1e293b'], cluster:'snow'},
      { label:'CA', radius:48, x:720, y:320, color:['#4ADE80','#22C55E','#FFFFFF'], cluster:'ca'},
      { label:'ABOUT', radius:50, x:350, y:360, color:['#0f172a','#020617','#000000'], cluster:'bomb'},
      { label:'', radius:45, x:980, y:520, color:palette.cyan, cluster:'coming'},
      { label:'', radius:50, x:1150, y:300, color:palette.pink, cluster:'casino'}
    ];

    const connections=[
      [0,1],[2,3],[4,5],[5,6],[7,8],[9,10],[11,12]
    ].map(([a,b])=>({a,b,restLength:null,stiffness:0.014,damping:0.18}));

    function withAlpha(hex,a){
      const v=Math.round(a*255).toString(16).padStart(2,'0');
      return hex+v;
    }

    const snowballImg=new Image();snowballImg.src='boule-de-neige.png'; // nouveau flocon
    const comingBubbleImg=new Image();comingBubbleImg.src='dexscreener-bubble.png';
    const casinoBubbleImg=new Image();casinoBubbleImg.src='casino-bubble.png';

    class Bubble{
      constructor(data,isBackground=false){
        this.label=data.label||'';
        this.radius=data.radius;
        this.x=data.x;this.y=data.y;
        this.color=data.color||['#9ca3af','#6b7280','#020617'];
        this.cluster=data.cluster||null;
        this.isBackground=isBackground;
        this.vx=isBackground?0:(Math.random()-0.5)*0.15;
        this.vy=isBackground?0:(Math.random()-0.5)*0.15;
        this.isDragging=false;
        this.floatOffset=Math.random()*Math.PI*2;
        this.floatSpeed=isBackground?0:(0.003+Math.random()*0.002);
      }
      draw(){
        ctx.save();
        if(this.cluster==='snow' || this.cluster==='coming' || this.cluster==='casino'){
          const r=this.radius;
          ctx.beginPath();ctx.arc(this.x,this.y,r,0,Math.PI*2);ctx.clip();
          let img=null;
          if(this.cluster==='snow') img=snowballImg;
          if(this.cluster==='coming') img=comingBubbleImg;
          if(this.cluster==='casino') img=casinoBubbleImg;
          if(img && img.complete && img.naturalWidth>0){
            const size=r*2;
            ctx.drawImage(img,this.x-size/2,this.y-size/2,size,size);
          }else{
            ctx.fillStyle='#111827';ctx.fill();
          }
          ctx.restore();return;
        }
        if(this.cluster==='bomb'){
          const g=ctx.createRadialGradient(
            this.x-this.radius*0.35,this.y-this.radius*0.35,this.radius*0.1,
            this.x,this.y,this.radius
          );
          g.addColorStop(0,'rgba(75,85,99,0.9)');
          g.addColorStop(0.4,'rgba(31,41,55,0.96)');
          g.addColorStop(1,'rgba(15,23,42,1)');
          ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
          ctx.fillStyle=g;ctx.fill();
          ctx.strokeStyle='rgba(15,23,42,1)';
          ctx.lineWidth=1.5;ctx.stroke();
          ctx.fillStyle='rgba(255,255,255,0.95)';
          ctx.font=`bold ${Math.max(11,this.radius/3.4)}px -apple-system,sans-serif`;
          ctx.textAlign='center';ctx.textBaseline='middle';
          ctx.fillText('ABOUT',this.x,this.y+this.radius*0.05);
          ctx.restore();return;
        }
        ctx.shadowColor=withAlpha(this.color[0],0.04);
        ctx.shadowBlur=this.radius*0.08;
        const grad=ctx.createRadialGradient(
          this.x-this.radius*0.3,this.y-this.radius*0.3,this.radius*0.1,
          this.x,this.y,this.radius
        );
        grad.addColorStop(0,withAlpha(this.color[0],0.4));
        grad.addColorStop(0.5,withAlpha(this.color[1],0.25));
        grad.addColorStop(1,withAlpha('#000010',0.25));
        ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
        ctx.fillStyle=grad;ctx.fill();
        ctx.shadowColor='transparent';
        if(!this.isBackground){
          ctx.strokeStyle='rgba(248,250,252,0.18)';
          ctx.lineWidth=0.8;ctx.stroke();
        }
        if(this.label){
          ctx.fillStyle='rgba(255,255,255,0.92)';
          ctx.font=`bold ${Math.max(10,this.radius/3.5)}px -apple-system,sans-serif`;
          ctx.textAlign='center';ctx.textBaseline='middle';
          ctx.fillText(this.label,this.x,this.y);
        }
        ctx.restore();
      }
      update(){
        if(this.isDragging || this.isBackground) return;
        this.floatOffset+=this.floatSpeed;
        const fx=Math.sin(this.floatOffset)*0.15;
        const fy=Math.cos(this.floatOffset*0.9)*0.15;
        this.x+=this.vx+fx;
        this.y+=this.vy+fy;
        if(this.x-this.radius<0){this.x=this.radius;this.vx*=-0.8;}
        if(this.x+this.radius>width){this.x=width-this.radius;this.vx*=-0.8;}
        if(this.y-this.radius<navHeight){this.y=navHeight+this.radius;this.vy*=-0.8;}
        if(this.y+this.radius>height){this.y=height-this.radius;this.vy*=-0.8;}
        this.vx*=0.995;this.vy*=0.995;
      }
      contains(mx,my){
        const dx=mx-this.x,dy=my-this.y;
        return dx*dx+dy*dy<this.radius*this.radius;
      }
    }

    const mainBubbles=bubbleData.map(d=>new Bubble(d,false));
    const backgroundBubbles=[];
    for(let i=0;i<70;i++){
      const r=5+Math.random()*8;
      const x=Math.random()*width;
      const y=navHeight+Math.random()*(height-navHeight);
      backgroundBubbles.push(new Bubble({label:'',radius:r,x,y,color:['#94a3b8','#64748b','#020617']},true));
    }

    function applySpringForces(dt){
      connections.forEach(c=>{
        const a=mainBubbles[c.a],b=mainBubbles[c.b];
        const dx=b.x-a.x,dy=b.y-a.y;
        const dist=Math.sqrt(dx*dx+dy*dy)||0.001;
        if(c.restLength==null)c.restLength=dist;
        const dirX=dx/dist,dirY=dy/dist;
        const stretch=dist-c.restLength;
        const spring=c.stiffness*stretch;
        const relVx=b.vx-a.vx,relVy=b.vy-a.vy;
        const damping=c.damping*(relVx*dirX+relVy*dirY);
        const total=spring+damping;
        const fx=dirX*total,fy=dirY*total;
        if(!a.isDragging){a.vx+=fx/a.radius;a.vy+=fy/a.radius;}
        if(!b.isDragging){b.vx-=fx/b.radius;b.vy-=fy/b.radius;}
      });
    }
    function drawConnections(){
      ctx.save();ctx.setLineDash([4,4]);
      connections.forEach(c=>{
        const a=mainBubbles[c.a],b=mainBubbles[c.b];
        const dx=b.x-a.x,dy=b.y-a.y;
        const dist=Math.sqrt(dx*dx+dy*dy)||0.001;
        const angle=Math.atan2(dy,dx);
        const x1=a.x+Math.cos(angle)*a.radius;
        const y1=a.y+Math.sin(angle)*a.radius;
        const x2=b.x-Math.cos(angle)*b.radius;
        const y2=b.y-Math.sin(angle)*b.radius;
        ctx.strokeStyle='rgba(148,163,184,0.32)';
        ctx.lineWidth=1;
        ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();
      });
      ctx.setLineDash([]);ctx.restore();
    }
    function checkCollisions(){
      for(let i=0;i<mainBubbles.length;i++){
        for(let j=i+1;j<mainBubbles.length;j++){
          const a=mainBubbles[i],b=mainBubbles[j];
          const dx=b.x-a.x,dy=b.y-a.y;
          const dist=Math.sqrt(dx*dx+dy*dy);
          const min=a.radius+b.radius;
          if(dist<min && dist>0){
            const angle=Math.atan2(dy,dx);
            const overlap=min-dist;
            const mx=Math.cos(angle)*overlap*0.5;
            const my=Math.sin(angle)*overlap*0.5;
            if(!a.isDragging){a.x-=mx;a.y-=my;}
            if(!b.isDragging){b.x+=mx;b.y+=my;}
          }
        }
      }
    }

    let draggedBubble=null,lastMouseX=0,lastMouseY=0;
    function startDrag(mx,my){
      const all=[...backgroundBubbles,...mainBubbles];
      for(let i=all.length-1;i>=0;i--){
        if(all[i].contains(mx,my)){
          draggedBubble=all[i];
          draggedBubble.isDragging=true;
          lastMouseX=mx;lastMouseY=my;
          break;
        }
      }
    }
    function moveDrag(mx,my){
      if(!draggedBubble)return;
      const dx=mx-lastMouseX,dy=my-lastMouseY;
      draggedBubble.x=mx;draggedBubble.y=my;
      draggedBubble.vx=dx*0.7;draggedBubble.vy=dy*0.7;
      lastMouseX=mx;lastMouseY=my;
    }
    function endDrag(){
      if(draggedBubble){draggedBubble.isDragging=false;draggedBubble=null;}
    }

    const bgVolume=document.getElementById('bgVolume');
    let bgStarted=false;
    const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;
    bgVolume.addEventListener('input',()=>{
      const v=parseFloat(bgVolume.value||'0');
      if(isIOS) bgMusic.muted=(v===0); else {bgMusic.muted=false;bgMusic.volume=v;}
    });
    function startBgOnce(){
      if(bgStarted)return;
      bgStarted=true;
      const v=parseFloat(bgVolume.value||'0.6');
      if(isIOS) bgMusic.muted=(v===0); else bgMusic.volume=v;
      bgMusic.play().catch(()=>{});
    }

    function handleCanvasClick(e){
      startBgOnce();
      const rect=canvas.getBoundingClientRect();
      const mx=(e.touches?e.touches[0].clientX:e.clientX)-rect.left;
      const my=(e.touches?e.touches[0].clientY:e.clientY)-rect.top;
      const casinoBubble=mainBubbles.find(b=>b.cluster==='casino');
      const snowBubble=mainBubbles.find(b=>b.cluster==='snow');
      const aboutBubble=mainBubbles.find(b=>b.cluster==='bomb');

      if(casinoBubble && casinoBubble.contains(mx,my)){openCasino();return;}
      if(aboutBubble && aboutBubble.contains(mx,my)){showAboutModal();return;}
      if(snowBubble && snowBubble.contains(mx,my)){
        // ici tu peux ouvrir ton overlay Snowball si tu en as un
        return;
      }
      if(!e.touches && e.type==='mousedown') startDrag(mx,my);
      else if(e.touches && e.type==='touchstart') startDrag(mx,my);
    }

    canvas.addEventListener('mousedown',handleCanvasClick);
    canvas.addEventListener('touchstart',e=>{e.preventDefault();handleCanvasClick(e);});
    canvas.addEventListener('mousemove',e=>{
      const r=canvas.getBoundingClientRect();
      moveDrag(e.clientX-r.left,e.clientY-r.top);
    });
    canvas.addEventListener('mouseup',endDrag);
    canvas.addEventListener('mouseleave',endDrag);
    canvas.addEventListener('touchmove',e=>{
      e.preventDefault();
      const r=canvas.getBoundingClientRect();
      const t=e.touches[0];
      moveDrag(t.clientX-r.left,t.clientY-r.top);
    });
    canvas.addEventListener('touchend',endDrag);
    canvas.addEventListener('touchcancel',endDrag);

    window.addEventListener('resize',()=>{
      width=canvas.width=window.innerWidth;
      height=canvas.height=window.innerHeight;
    });

    let lastTime=null;
    function animate(ts){
      if(lastTime==null) lastTime=ts;
      const dt=(ts-lastTime)/1000;lastTime=ts;
      ctx.fillStyle='#050814';ctx.fillRect(0,0,width,height);
      applySpringForces(dt);
      checkCollisions();
      drawConnections();
      backgroundBubbles.forEach(b=>b.draw());
      mainBubbles.forEach(b=>{b.update();b.draw();});
      requestAnimationFrame(animate);
    }
    animate();

    /* ---- MINI CASINO LOGIC avec 3 niveaux de gains ---- */
const slotSpinBtn = document.getElementById('slotSpinBtn');
const reel1 = document.getElementById('reel1');
const reel2 = document.getElementById('reel2');
const reel3 = document.getElementById('reel3');
const slotStatus = document.getElementById('slotStatus');
const slotAttempts = document.getElementById('slotAttempts');

const SLOT_MAX_ATTEMPTS = 3;
const SLOT_WINDOW_MS = 60 * 60 * 1000; // 1h
const SLOT_STORAGE_KEY = 'slot_session_v5';

function loadSlotSession(){
  try{
    const raw = localStorage.getItem(SLOT_STORAGE_KEY);
    if(!raw) return { start: Date.now(), attempts: 0 };
    const obj = JSON.parse(raw);
    if(typeof obj.start !== 'number' || typeof obj.attempts !== 'number'){
      return { start: Date.now(), attempts: 0 };
    }
    if(Date.now() - obj.start > SLOT_WINDOW_MS){
      return { start: Date.now(), attempts: 0 };
    }
    return obj;
  }catch(e){
    return { start: Date.now(), attempts: 0 };
  }
}
function saveSlotSession(s){
  localStorage.setItem(SLOT_STORAGE_KEY, JSON.stringify(s));
}

let slotSession = loadSlotSession();
updateSlotUI();

function updateSlotUI(){
  const remaining = SLOT_MAX_ATTEMPTS - slotSession.attempts;
  slotStatus.classList.remove('win','lose','cooldown');
  if(remaining > 0){
    slotAttempts.textContent = `Attempts left: ${remaining}/3`;
    slotSpinBtn.disabled = false;
  }else{
    const msLeft = SLOT_WINDOW_MS - (Date.now() - slotSession.start);
    const mins = Math.max(1, Math.ceil(msLeft / 60000));
    slotSpinBtn.disabled = true;
    slotStatus.textContent = 'RETRY YOUR CHANCE IN 1H';
    slotStatus.classList.add('cooldown');
    slotAttempts.textContent = `Next reset in ~${mins} min`;
  }
}

function makeSymbolElement(symbol){
  const span = document.createElement('span');
  if(symbol === '7'){
    span.textContent = '7';
    span.className = 'seven';
  }else if(symbol === 'BAR'){
    span.textContent = 'BAR';
    span.className = 'bar';
  }else if(symbol === 'BELL'){
    span.textContent = 'ðŸ””';
    span.className = 'bell';
  }else{
    span.textContent = symbol;
  }
  return span;
}
function setReelSymbol(reelEl, symbol){
  reelEl.innerHTML = '';
  reelEl.appendChild(makeSymbolElement(symbol));
}

function spinRandomSymbol(){
  const symbols = ['7','BAR','BELL','ðŸ’','â­'];
  return symbols[Math.floor(Math.random() * symbols.length)];
}

slotSpinBtn.addEventListener('click', () => {
  slotSession = loadSlotSession();
  if(slotSession.attempts >= SLOT_MAX_ATTEMPTS){
    updateSlotUI();
    return;
  }

  slotSpinBtn.disabled = true;
  slotStatus.textContent = 'Spinning...';
  slotStatus.classList.remove('win','lose','cooldown');

  const spinDuration = 1200;
  const start = performance.now();

  function animateReels(t){
    const elapsed = t - start;
    const progress = Math.min(1, elapsed / spinDuration);
    const speedFactor = 1 - Math.pow(progress, 2);

    const o1 = Math.sin(t * 0.015) * speedFactor * 10;
    const o2 = Math.sin(t * 0.018 + 1) * speedFactor * 12;
    const o3 = Math.sin(t * 0.02 + 2) * speedFactor * 14;

    reel1.style.transform = `translateY(${o1}px)`;
    reel2.style.transform = `translateY(${o2}px)`;
    reel3.style.transform = `translateY(${o3}px)`;

    if(progress < 1){
      setReelSymbol(reel1, spinRandomSymbol());
      setReelSymbol(reel2, spinRandomSymbol());
      setReelSymbol(reel3, spinRandomSymbol());
      requestAnimationFrame(animateReels);
    }else{
      reel1.style.transform = 'translateY(0)';
      reel2.style.transform = 'translateY(0)';
      reel3.style.transform = 'translateY(0)';

      // NOUVELLES PROBAS :
      // 0.4% -> 777 (1 SOL)
      // 2%   -> BAR BAR BAR (0.3 SOL)
      // 5%   -> BELL BELL BELL (0.1 SOL)
      const r = Math.random();
      let s1, s2, s3;
      let winMsg = null;

      if(r < 0.004){
        s1 = s2 = s3 = '7';
        winMsg = 'GG YOU WIN 1 SOL MAKE A SCREEN AND SEND IT IN COMMUNITY';
      }else if(r < 0.004 + 0.02){
        s1 = s2 = s3 = 'BAR';
        winMsg = 'GG YOU WIN 0.3 SOL MAKE A SCREEN AND SEND IT IN COMMUNITY';
      }else if(r < 0.004 + 0.02 + 0.05){
        s1 = s2 = s3 = 'BELL';
        winMsg = 'GG YOU WIN 0.1 SOL MAKE A SCREEN AND SEND IT IN COMMUNITY';
      }else{
        const nonJackpot = ['BAR','BELL','ðŸ’','â­'];
        s1 = spinRandomSymbol();
        s2 = spinRandomSymbol();
        s3 = spinRandomSymbol();
        // si par hasard on tombe sur un jackpot, on casse la combinaison
        if((s1==='7'&&s2==='7'&&s3==='7')||
           (s1==='BAR'&&s2==='BAR'&&s3==='BAR')||
           (s1==='BELL'&&s2==='BELL'&&s3==='BELL')){
          s3 = nonJackpot[Math.floor(Math.random()*nonJackpot.length)];
        }
      }

      setReelSymbol(reel1, s1);
      setReelSymbol(reel2, s2);
      setReelSymbol(reel3, s3);

      slotSession.attempts++;
      saveSlotSession(slotSession);

      if(winMsg){
        slotStatus.textContent = winMsg;
        slotStatus.classList.add('win');
      }else{
        slotStatus.textContent = 'No win this time.';
        slotStatus.classList.add('lose');
      }
      updateSlotUI();
    }
  }
  requestAnimationFrame(animateReels);
});

  </script>
</body>
</html>
